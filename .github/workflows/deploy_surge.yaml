name: Deployment

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    name: Deploy to surge.sh
    steps:
      - uses: actions/checkout@v1
      - name: Setup node environment
        uses: actions/setup-node@v1
        with:
          node-version: 12
      - run: npm install --production
      - run: npm audit
      - run: CI=false REACT_APP_CANONICAL_URL=${{ secrets.CANONNICAL_URL_STAGING }} REACT_APP_GITHUB_SHA="$GITHUB_SHA" npm run build
      - run: ./node_modules/.bin/surge ./build --domain ${{ secrets.SURGE_DOMAIN }} --token ${{ secrets.SURGE_TOKEN }}
